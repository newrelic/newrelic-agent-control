---

- name: nrql request to get metrics sent by the NR Otel Collector
  include_role:
    name: caos.ansible_roles.nrql_api_request
    apply:
      become: false
  vars:
    nrql_query: >-
      SELECT count(`system.cpu.utilization`) AS datapoints
      FROM Metric
      WHERE host.name LIKE '{{ ansible_hostname }}%'
      AND state = 'system'
      SINCE 30 SECONDS AGO

- name: assert that nr-otel-collector is sending data
  assert:
    that:
      - results[0]["datapoints"] > 0
    success_msg: "NR Otel Collector is sending expected data"

...