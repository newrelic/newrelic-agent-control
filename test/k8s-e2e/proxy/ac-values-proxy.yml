# Cluster and License info is set with "--set" in the e2e-spec file
installationJob:
  logLevel: debug

# Flux proxy configuration.
flux2:
  sourceController:
    extraEnv:
      # Configures Flux source-controller to proxy all request.
      - name: HTTPS_PROXY
        value: https://mitmproxy-service:8080
      # except for in-cluster request.
      - name: "NO_PROXY"
        value: ".cluster.local.,.cluster.local,cluster.local,.svc,127.0.0.0/8,10.0.0.0/8"
    volumeMounts:
      # Mount a CA certificate bundle to the source-controller Trust root store.
      # It should contain the proxy CA certificates on it.
      - mountPath: /etc/ssl/certs/ca-certificates.crt
        subPath: ca-certificates.crt
        name: shared-volume-ca
    volumes:
      - name: shared-volume-ca
        persistentVolumeClaim:
          claimName: mitm-ca-pvc


agent-control-deployment:
  subAgentsNamespace: "newrelic-agents"
  verboseLog: true # It is propagated to some agents (same as licenseKey and cluster)
  # Mount a CA certificate bundle to the source-controller Trust root store.
  # It should contain the proxy CA certificates on it.
  extraVolumeMounts:
    - mountPath: /etc/ssl/certs/ca-certificates.crt
      subPath: ca-certificates.crt
      name: shared-volume-ca
  extraVolumes:
    - name: shared-volume-ca
      persistentVolumeClaim:
        claimName: mitm-ca-pvc
  config:
    fleet_control:
      enabled: true
      # Fleet with name 'ac-e2e-empty-deployment'. The sub-agent reports data to the 'Agent Control Canaries' account.
      # This fleet doesn't have any deployment configured.
      fleet_id: NjQyNTg2NXxOR0VQfEZMRUVUfDAxOTgwOTZiLTk2NzctNzllNi05OWJmLTQ4YWRlOTRiYmZjMw
      auth:
        secret:
          create: false
          name: "sys-identity"
    agentControl:
      content:
        proxy:
          url: https://mitmproxy-service:8080
        fleet_control:
          signature_validation:
            # Disable this as is not supported by the proxy.
            # On a prod environment is recommended to add an exception for the firewall to newrelic.com or 
            # mount the downloaded Certificate.
            enabled: false
    subAgents:
      prometheus:
        type: newrelic/com.newrelic.prometheus:0.1.0
        content:
          chart_version: "*"
          # Proxy config should be added to Prom config on a prod environment. But this is out of scope of AC.
