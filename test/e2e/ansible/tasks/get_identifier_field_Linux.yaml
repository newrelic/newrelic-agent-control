---
- name: Wait for identifiers file to be created
  ansible.builtin.wait_for:
    path: "{{ agent_identifier_path }}"
    state: present
    timeout: 300

- name: Get the identifier field provided
  shell: "grep -Eo '{{ identifier_field }}:\\s*([^[:space:]]+)' {{ agent_identifier_path }} | cut -d ' ' -f 2"
  register: field_result

# output facts
- name: set identifier fact
  ansible.builtin.set_fact: {"{{ identifier_field_fact }}": "{{ field_result.stdout }}"}


