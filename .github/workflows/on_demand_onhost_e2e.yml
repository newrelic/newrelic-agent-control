name: ‚èØÔ∏èüöÄüíæ OnHost E2E test on demand

on:
  workflow_dispatch:
    inputs:
      scenarios:
        description: 'JSON array of test scenarios from test/onhost_e2e/ansible to run (e.g., ["migration.yaml"] )'
        required: true
        type: string
      package_version:
        description: 'Package version to test (e.g., 0.48.0). Leave empty to use latest.'
        required: false
        type: string
        default: ""
      repository_endpoint:
        description: 'Repository endpoint to fetch packages from'
        required: false
        type: string
        default: "http://nr-downloads-ohai-staging.s3-website-us-east-1.amazonaws.com/preview"

permissions:
  contents: read

jobs:
  onhost-e2e:
    uses: ./.github/workflows/component_onhost_e2e.yaml
    with:
      scenarios: ${{ inputs.scenarios }}
      repository_endpoint: ${{ inputs.repository_endpoint }}
      package_version: ${{ inputs.package_version }}
    secrets:
      NR_SYSTEM_IDENTITY_CLIENT_ID: ${{ secrets.AC_PROD_E2E_NR_SYSTEM_IDENTITY_CLIENT_ID }}
      NR_SYSTEM_IDENTITY_PRIVATE_KEY: ${{ secrets.AC_PROD_E2E_NR_SYSTEM_IDENTITY_PRIVATE_KEY }}
      E2E_ACCOUNT_ID: ${{ secrets.AC_PROD_E2E_ACCOUNT_ID }}
      E2E_API_KEY: ${{ secrets.AC_PROD_E2E_API_KEY }}
      E2E_LICENSE_KEY: ${{ secrets.AC_PROD_E2E_LICENSE_KEY }}
