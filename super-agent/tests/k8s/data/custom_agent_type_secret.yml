namespace: newrelic
name: com.newrelic.custom_agent
version: 0.0.1
variables:
  k8s:
    secret_name_override:
      description: "secret_name_override"
      type: string
      required: false
      default: ""
deployment:
  k8s:
    health:
      interval: 30s
    objects:
      repository:
        apiVersion: source.toolkit.fluxcd.io/v1
        kind: HelmRepository
        metadata:
          name: ${nr-sub:agent_id}
        spec:
          interval: 30m
          provider: generic
          url: https://helm.github.io/examples
      default-values:
        apiVersion: v1
        kind: Secret
        metadata:
          name: default-values-${nr-sub:agent_id}
        stringData:
          values.yaml: |
            nameOverride: ${nr-var:secret_name_override}
      release:
        apiVersion: helm.toolkit.fluxcd.io/v2
        kind: HelmRelease
        metadata:
          name: ${nr-sub:agent_id}
        spec:
          interval: 3m
          chart:
            spec:
              chart: hello-world
              version: 0.1.0
              reconcileStrategy: ChartVersion
              sourceRef:
                kind: HelmRepository
                name: ${nr-sub:agent_id}
              interval: 3m
          install:
            disableWait: true
            disableWaitForJobs: true
            remediation:
              retries: 3
            replace: true
          upgrade:
            disableWait: true
            disableWaitForJobs: true
            cleanupOnFail: true
            force: true
          valuesFrom:
            - kind: Secret
              name: default-values-${nr-sub:agent_id}
              valuesKey: values.yaml
